<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>P2Skating - Jump Review</title>
  <link rel="stylesheet" href="/static/css/common.css">
  <style>
    .layout.column { gap: 16px; align-items: stretch; }
    .topLeft { flex: 1.2; min-width: 520px; }
    .topRight { flex: 1.0; min-width: 420px; }
  </style>
</head>
<body data-nav-page="jumps">
  <!-- PRELOAD_JUMPSS -->
  <div id="navContainer"></div>

  <div class="page layout column" data-page="jumps">
    <!-- TOP: IMU + Video side-by-side -->
    <div class="row">
      <div class="col topLeft">
        <div class="panel" style="margin-top:0;">
          <h3>IMU plots (playback)</h3>
          <div style="margin-top: 6px;">
            <strong>Acceleration (X/Y/Z)</strong>
            <canvas id="plotAcc" width="900" height="140" style="display:block; margin-top:4px; border:1px solid #ddd; width:100%;"></canvas>
          </div>
          <div style="margin-top: 10px;">
            <strong>Gyro (X/Y/Z)</strong>
            <canvas id="plotGyro" width="900" height="140" style="display:block; margin-top:4px; border:1px solid #ddd; width:100%;"></canvas>
          </div>
          <div style="margin-top: 10px;">
            <strong>Magnetometer (X/Y/Z)</strong>
            <canvas id="plotMag" width="900" height="140" style="display:block; margin-top:4px; border:1px solid #ddd; width:100%;"></canvas>
    </div>
    </div>
  </div>

      <div class="col topRight">
        <div class="panel" style="margin-top:0;">
          <h3>Video playback</h3>
          <video id="videoPlayer" style="width:100%; border:1px solid #ddd; background:#000;" preload="metadata" controls></video>
          <div class="btnRow" style="margin-top:8px;">
            <button id="playBtn" data-action="play">Play</button>
            <button id="playHalfBtn" data-action="play-half">Play 0.5x</button>
            <button id="playQuarterBtn" data-action="play-quarter">Play 0.25x</button>
            <button id="markStartBtn" data-action="mark-start">Mark Start</button>
            <button id="markEndBtn" data-action="mark-end">Mark End</button>
            <button id="recomputeBtn" data-action="recompute">Recompute</button>
            <button id="prevFrameBtn" data-action="prev-frame">Prev frame</button>
            <button id="nextFrameBtn" data-action="next-frame">Next frame</button>
            <button id="stopBtn" data-action="stop">Stop</button>
            <button id="backBtn" data-action="back">Back</button>
            <span id="playerStatus" class="small"></span>
          </div>
          <div class="small" style="margin-top:6px;">
            Playback uses the per-jump clip if available; otherwise it falls back to the full session video.
            If `video.mp4` is missing, the server will try to auto-mux from `video.h264` on demand (requires `ffmpeg`).
          </div>
        </div>
      </div>
    </div>

    <!-- BOTTOM: list left, annotation + details right -->
    <div class="row">
      <div class="col">
        <div class="panel" style="margin-top:0;">
          <h3>Detected Jumps (DB)</h3>
          <div class="small">Ordered by detection time (descending).</div>
          <div class="btnRow">
            <button id="refreshBtn" data-action="refresh">Refresh</button>
            <span id="dbStatus" class="small"></span>
          </div>
          <ul id="jumpList" style="list-style: none; padding-left: 0; margin-top: 8px;"><!-- JUMP_LIST_ITEMS --></ul>
  </div>
      </div>

      <div class="col">
        <div class="panel" style="margin-top:0;">
          <h3>Jump Annotation</h3>
          <div style="margin-top: 6px;">
            <label style="display:block; margin-bottom:6px; font-size:12px;">
            Jump name:
            <input id="jumpNameInput" type="text" style="width: 100%; box-sizing: border-box;">
          </label>
            <textarea id="jumpNote" rows="6" style="width: 100%; box-sizing: border-box;"></textarea>
            <div class="btnRow">
              <button id="saveAnnotationBtn" data-action="save-annotation">Save annotation</button>
              <span id="annotationStatus" class="small"></span>
            </div>
            <div class="small" style="margin-top:6px;">
              Annotations are saved to server memory and best-effort persisted to DB (if configured).
            </div>
        </div>
        </div>

        <div class="panel">
            <div style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
            <h3 style="margin:0;">Selected Jump Detail</h3>
            <div style="display:flex; align-items:center; gap:8px;">
              <button id="deleteJumpBtn" data-action="delete-jump" style="background:#d32f2f; color:#fff; border:1px solid #b71c1c;">Delete selected jump(s)</button>
              <span id="deleteStatus" class="small"></span>
            </div>
          </div>
          <div id="jumpDetail" style="font-size: 12px; margin-top: 6px;">
            <div><em>No jump selected</em></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="panel">
    <h3>Log</h3>
    <pre id="logBox" style="height: 220px; overflow-y: auto; border: 1px solid #ddd; padding: 6px; background: #fafafa; font-size: 11px;"></pre>
  </div>

  <script src="/static/js/common.js"></script>
  <script src="/static/js/jumps.js"></script>
</body>
</html>
